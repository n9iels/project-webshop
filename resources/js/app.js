var Router=function(){function e(e,r){if(0!=t(e)){var i=n(e);switch(i[0]){case"":case"index.html":case"products":new ProductsController(new ProductsViewHelper,new ProductsModel).main();break;case"product":new ProductController(new ProductViewHelper,new ProductModel(i[1])).main();break;case"register":new RegisterController(new RegisterViewHelper,new RegisterModel).main();break;case"login":new LoginController(new LoginViewHelper,new LoginModel).main();break;case"logout":new LogoutController(new LogoutViewHelper,new LogoutModel).main();break;default:new ErrorController(new ErrorViewHelper).main()}0!=r&&(""==e&&(e="index.html"),o({},"A-Z Games",e),window.scrollTo(0,0))}}function t(e){return e.indexOf("http")==-1&&e.indexOf("https")==-1&&e.indexOf("www")==-1||(window.location=e,!1)}function n(e){return 0==e.indexOf("/")&&(e=e.substring(1)),null!=this.baseUrl&&e.indexOf(this.baseUrl)!=-1&&(e=e.substring(e.indexOf(this.baseUrl)+this.baseUrl.length)),e.split(/\/(.+)?/)}function o(e,t,n){window.history.pushState(e,t,n)}return baseUrl="project-webshop/",{route:e}},LoginModel=function(){function e(e,t,n){$.ajax({url:"http:///84.84.245.29:243/user/login",type:"post",dataType:"json",data:JSON.stringify({email:e,password:t}),success:function(e){document.cookie="access_token="+e.access_token,document.cookie="user_id="+e.user_id,n(e)},error:function(e,t,n){$("#error_message").show()}})}return{login:e}},LogoutModel=function(){function e(e){function t(e){for(var t=document.cookie.split(";"),n=0;n<t.length;n++){var o=t[n].split("=");if(o[0].trim()==e)return o[1]}}$.ajax({url:"http://84.84.245.29:243/user/logout",type:"post",dataType:"json",data:JSON.stringify({user_id:t("user_id")}),success:function(t){document.cookie="access_token=",document.cookie="user_id=",e(t)},error:function(e,t,n){$("#error_message").show()}})}return{logout:e}},PageModel=function(){function e(e){$.ajax({url:"http://84.84.245.29:243/user",type:"get",dataType:"json",headers:{Authorization:"Bearer "+t("access_token")},success:function(t){e(t)},error:function(e,t,n){$("#component").load("/error.html")}})}function t(e){for(var t=document.cookie.split(";"),n=0;n<t.length;n++){var o=t[n].split("=");if(o[0]==e)return o[1]}}return{getPage:e}},ProductsModel=function(){function e(e,t){$.ajax({url:"http://84.84.245.29:243/products?"+e,type:"get",dataType:"json",success:function(e){t(e)},error:function(e,t,n){$("#component").load("views/error/error.html")}})}return{getPage:e}},RegisterModel=function(){function e(e,t){console.log(e),$.ajax({url:"http://84.84.245.29:243/user/register",type:"post",dataType:"json",data:JSON.stringify({e_mail:e.e_mailadres,password:e.wachtwoord,first_name:e.voornaam,surname:e.achternaam,gender:e.gender,date_of_birth:e.birth_date,phone_number:e.mobiel_nummer,secret_question:e.security_question,secret_question_answer:e.security_answer}),success:function(e){t(e)},error:function(e,t,n){$("#regi_api_error_message").show()}})}return{register:e}},ProductModel=function(e){function t(t){$.ajax({url:"http://84.84.245.29:243/products/"+e,type:"get",dataType:"json",success:function(e){t(e[0])},error:function(e,t,n){$("#component").load("/error.html")}})}return{GetProductInfo:t}},ErrorController=function(e){function t(){n.setView()}var n=e;return{main:t}},LoginController=function(e,t){function n(e){e.preventDefault();var t={};$.each($(this).serializeArray(),function(e,n){t[n.name]=n.value}),r.login(t.email,t.password,function(e){$("#inloggen_text").hide(),$("#uitloggen_text").show(),new PageController(new PageViewHelper,new PageModel).main()})}function o(){i.setView(),i.setActionListener(n)}var r=t,i=e;return{main:o}},LogoutController=function(e,t){function n(e){r.logout(function(e){$("#inloggen_text").show(),$("#uitloggen_text").hide(),i.setView()})}function o(){i.setActionListener(n)}var r=t,i=e;return{main:o}},PageController=function(e,t){function n(e){r.getPage(function(e){i.setView(e)})}function o(){i.setActionListener(n)}var r=t,i=e;return{main:o}},ProductsController=function(e,t){function n(){i.getPage("",function(e){s.setView(e)})}function o(e){e.preventDefault();var t=$(this).serialize();i.getPage(t,function(e){s.loadProducts(e)})}function r(){s.setActionListener(n),s.setFilterListener(o)}var i=t,s=e;return{main:r}},RegisterController=function(e,t){function n(){console.log("in actionPerformed"),event.preventDefault(),$("#regi_api_error_message").hide(),$("#ww2_error_message").hide();var e={};$.each($(this).serializeArray(),function(t,n){e[n.name]=n.value}),e.birth_date=e.jaar+"-"+e.maand+"-"+e.dag;var t=!1,n=["voornaam","achternaam","postcode","huisnummer","e_mailadres","wachtwoord","wachtwoord2","security_answer"];$.each(n,function(e,t){$("#"+t).removeClass("invalid")}),$.each(n,function(n,o){""==e[o]&&($("#"+o).addClass("invalid"),t=!0)}),t&&(window.scrollTo(0,0),$("#register_error_message").show());var o=!1;return e.wachtwoord!=e.wachtwoord2&&(o=!0,$("#ww2_error_message").show(),$("#wachtwoord").addClass("invalid"),$("#wachtwoord2").addClass("invalid")),!t&&!o&&void r.register(e,function(e){i.setView("/views/register/after_register.html")})}function o(){i.setView("/views/register/register.html"),i.setActionListener(n)}var r=t,i=e;return{main:o}},ProductController=function(e,t){function n(n){t.GetProductInfo(function(t){e.setView(t)})}function o(){e.setActionListener(n)}return{main:o}},ErrorViewHelper=function(){function e(){$("#component").load("/views/error/error.html")}function t(e){$(document).ready(e)}return{setView:e,setActionListener:t}},LoginViewHelper=function(){function e(){$("#component").load("/views/login/login.html")}function t(e){$("#component").on("submit","#loginform",e)}return{setView:e,setActionListener:t}},LogoutViewHelper=function(){function e(){$("#component").load("/views/logout/logout.html")}function t(e){$(document).ready(e)}return{setView:e,setActionListener:t}},PageViewHelper=function(){function e(e){$("#component").load("/views/page/page.html",function(){"customer"==e[0].user_type&&$("#user-block").append("<h1>Je lees dit alleen als je een customer bent"),"admin"==e[0].user_type&&$("#user-block").append("<h1>Je lees dit alleen als je een administrator bent")})}function t(e){$(document).ready(e)}return{setView:e,setActionListener:t}},ProductsViewHelper=function(){function e(e){$("#component").html('<div class="col-12"><div class="col-3" id="filters"></div><div class="col-9" id="products"></div></div>'),$("#filters").load("/views/products/filters.html"),t(e)}function t(e){$("#products").load("views/products/products.html",function(){$.each(e,function(e,t){var r=$("<div>").append($("#product__list__item").clone());$(r).find(".product__title").html(t.title),$(r).find(".product__subtitle").append(t.genre+" | PEGI "+t.pegi_age+" | "+o(t.platform)),$(r).find(".product__description").html(n(t.description)),$(r).find(".product__price").append("€ "+t.price),$(r).find("#buttons__info").attr("href","product/"+t.ean_number),$(r).find(".product__image img").attr("src",t.image),$("#product__list").append(r)}),$("#product__list__item").first().remove()})}function n(e){var t=50,n=e.split(" ");if(n.length>t){var o="";for(i=0;i<t;i++)o+=n[i]+" ";return o+"..."}return e}function o(e){switch(e=e.toUpperCase()){case"PS4":return"<img src='https://maxcdn.icons8.com/Android_L/PNG/48/Logos/play_station_copyrighted-48.png' />";case"PC":return"<img src='https://maxcdn.icons8.com/Color/PNG/48/Operating_Systems/windows_logo_copyrighted-48.png' />";case"XBOX":return"<img src='https://maxcdn.icons8.com/Color/PNG/48/Logos/xbox-48.png' />";case"NINTENDO":return"<img src='https://maxcdn.icons8.com/Color/PNG/48/Gaming/nintendo-48.png' />";default:return e}}function r(e){$(document).ready(e)}function s(e){$("#component").on("change","input[type=checkbox]",function(e){$("#product_filter").submit()}),$("#component").on("submit","#product_filter",e)}return{setView:e,loadProducts:t,setActionListener:r,setFilterListener:s}},RegisterViewHelper=function(){function e(e){$("#component").load(e)}function t(e){$("#component").on("submit","#registerform",e)}return{setView:e,setActionListener:t}},ProductViewHelper=function(){function e(e){$("#component").load("/views/single_product/single_product.html",function(){$(".singleproduct__image img").attr("src",e.image),$(".singleproduct__title").html(e.title),$(".singleproduct__price").html("€ "+e.price),$(".product__ean").append(e.ean_number),$(".product__platform").append(e.platform),$(".product__publisher").append(e.publisher),$(".product__pegi").append(e.pegi_age),$(".product__genre").append(e.genre);var t=new Date(e.release_date),n=["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"];$(".liproduct__releasedate").append(t.getDay()+" "+n[t.getMonth()]+" "+t.getFullYear()),$(".singleproduct__descr").html(e.description)})}function t(e){$(document).ready(e)}return{setView:e,setActionListener:t}};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJvdXRlci5qcyIsImxvZ2luX21vZGVsLmpzIiwibG9nb3V0X21vZGVsLmpzIiwicGFnZV9tb2RlbC5qcyIsInByb2R1Y3RzX21vZGVsLmpzIiwicmVnaXN0ZXJfbW9kZWwuanMiLCJzaW5nbGVfcHJvZHVjdF9tb2RlbC5qcyIsImVycm9yX2NvbnRyb2xsZXIuanMiLCJsb2dpbl9jb250cm9sbGVyLmpzIiwibG9nb3V0X2NvbnRyb2xsZXIuanMiLCJwYWdlX2NvbnRyb2xsZXIuanMiLCJwcm9kdWN0c19jb250cm9sbGVyLmpzIiwicmVnaXN0ZXJfY29udHJvbGxlci5qcyIsInNpbmdsZV9wcm9kdWN0X2NvbnRyb2xsZXIuanMiLCJlcnJvci9lcnJvcl92aWV3LmpzIiwibG9naW4vbG9naW5fdmlldy5qcyIsImxvZ291dC9sb2dvdXRfdmlldy5qcyIsInBhZ2UvcGFnZV92aWV3LmpzIiwicHJvZHVjdHMvcHJvZHVjdHNfdmlldy5qcyIsInJlZ2lzdGVyL3JlZ2lzdGVyX3ZpZXcuanMiLCJzaW5nbGVfcHJvZHVjdC9zaW5nbGVfcHJvZHVjdF92aWV3LmpzIl0sIm5hbWVzIjpbIlJvdXRlciIsInJvdXRlIiwidXJsIiwiaGlzdG9yeSIsImlzSW50ZXJuYWwiLCJwYXJ0aWNsZXMiLCJnZXRQYXJ0aWNsZXMiLCJQcm9kdWN0c0NvbnRyb2xsZXIiLCJQcm9kdWN0c1ZpZXdIZWxwZXIiLCJQcm9kdWN0c01vZGVsIiwibWFpbiIsIlByb2R1Y3RDb250cm9sbGVyIiwiUHJvZHVjdFZpZXdIZWxwZXIiLCJQcm9kdWN0TW9kZWwiLCJSZWdpc3RlckNvbnRyb2xsZXIiLCJSZWdpc3RlclZpZXdIZWxwZXIiLCJSZWdpc3Rlck1vZGVsIiwiTG9naW5Db250cm9sbGVyIiwiTG9naW5WaWV3SGVscGVyIiwiTG9naW5Nb2RlbCIsIkxvZ291dENvbnRyb2xsZXIiLCJMb2dvdXRWaWV3SGVscGVyIiwiTG9nb3V0TW9kZWwiLCJFcnJvckNvbnRyb2xsZXIiLCJFcnJvclZpZXdIZWxwZXIiLCJ3cml0ZUhpc3RvcnkiLCJ3aW5kb3ciLCJzY3JvbGxUbyIsImluZGV4T2YiLCJsb2NhdGlvbiIsInN1YnN0cmluZyIsInRoaXMiLCJiYXNlVXJsIiwibGVuZ3RoIiwic3BsaXQiLCJvYmplY3QiLCJ0aXRsZSIsInB1c2hTdGF0ZSIsImxvZ2luIiwiZW1haWwiLCJwYXNzd29yZCIsImNhbGxiYWNrIiwiJCIsImFqYXgiLCJ0eXBlIiwiZGF0YVR5cGUiLCJkYXRhIiwiSlNPTiIsInN0cmluZ2lmeSIsInN1Y2Nlc3MiLCJkb2N1bWVudCIsImNvb2tpZSIsImFjY2Vzc190b2tlbiIsInVzZXJfaWQiLCJlcnJvciIsInhociIsInN0YXR1cyIsInNob3ciLCJsb2dvdXQiLCJnZXRDb29raWUiLCJuYW1lIiwiY29va2llcyIsImkiLCJ0cmltIiwiUGFnZU1vZGVsIiwiZ2V0UGFnZSIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwibG9hZCIsImZpbHRlciIsInJlZ2lzdGVyIiwiZm9ybURhdGEiLCJjb25zb2xlIiwibG9nIiwiZV9tYWlsIiwiZV9tYWlsYWRyZXMiLCJ3YWNodHdvb3JkIiwiZmlyc3RfbmFtZSIsInZvb3JuYWFtIiwic3VybmFtZSIsImFjaHRlcm5hYW0iLCJnZW5kZXIiLCJkYXRlX29mX2JpcnRoIiwiYmlydGhfZGF0ZSIsInBob25lX251bWJlciIsIm1vYmllbF9udW1tZXIiLCJzZWNyZXRfcXVlc3Rpb24iLCJzZWN1cml0eV9xdWVzdGlvbiIsInNlY3JldF9xdWVzdGlvbl9hbnN3ZXIiLCJzZWN1cml0eV9hbnN3ZXIiLCJlYW4iLCJHZXRQcm9kdWN0SW5mbyIsInZpZXdIZWxwZXIiLCJWaWV3SGVscGVyIiwic2V0VmlldyIsIm1vZGVsIiwiYWN0aW9uUGVyZm9ybWVkIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsImVhY2giLCJzZXJpYWxpemVBcnJheSIsImZpZWxkIiwidmFsdWUiLCJNb2RlbCIsImhpZGUiLCJQYWdlQ29udHJvbGxlciIsIlBhZ2VWaWV3SGVscGVyIiwic2V0QWN0aW9uTGlzdGVuZXIiLCJWaWV3IiwiZmlsdGVyUHJvZHVjdHMiLCJmaWx0ZXJzIiwic2VyaWFsaXplIiwibG9hZFByb2R1Y3RzIiwic2V0RmlsdGVyTGlzdGVuZXIiLCJqYWFyIiwibWFhbmQiLCJkYWciLCJtYW5kYXRvcnlGaWVsZE1pc3NlcyIsIm1hbmRhdG9yeUZpZWxkcyIsIm1hbkZpZWxkIiwicmVtb3ZlQ2xhc3MiLCJhZGRDbGFzcyIsInBhc3N3b3Jkc05vdElkZW50aWNhbCIsIndhY2h0d29vcmQyIiwiZXZlbnRIYW5kbGVyIiwicmVhZHkiLCJhY3Rpb24iLCJvbiIsInZpZXdEYXRhIiwidXNlcl90eXBlIiwiYXBwZW5kIiwiaHRtbCIsImtleSIsInByb2R1Y3QiLCJjbG9uZSIsImZpbmQiLCJnZW5yZSIsInBlZ2lfYWdlIiwiUGxhdGZvcm1Mb2dvIiwicGxhdGZvcm0iLCJDdXRTdHJpbmciLCJkZXNjcmlwdGlvbiIsInByaWNlIiwiYXR0ciIsImVhbl9udW1iZXIiLCJpbWFnZSIsImZpcnN0IiwicmVtb3ZlIiwidGV4dCIsIlNob3dBbW91bnQiLCJXb3Jkc0FycmF5IiwiU2hvcnRTdHJpbmciLCJwbGF0Zm9ybW5hYW0iLCJ0b1VwcGVyQ2FzZSIsInN1Ym1pdCIsInZpZXdUb1Nob3ciLCJwdWJsaXNoZXIiLCJkIiwiRGF0ZSIsInJlbGVhc2VfZGF0ZSIsIm1vbnRocyIsImdldERheSIsImdldE1vbnRoIiwiZ2V0RnVsbFllYXIiXSwibWFwcGluZ3MiOiJBQUFBLEdBQUFBLFFBQUEsV0FJQSxRQUFBQyxHQUFBQyxFQUFBQyxHQUVBLEdBQUEsR0FBQUMsRUFBQUYsR0FBQSxDQUtBLEdBQUFHLEdBQUFDLEVBQUFKLEVBRUEsUUFBQUcsRUFBQSxJQUVBLElBQUEsR0FDQSxJQUFBLGFBQ0EsSUFBQSxXQUNBLEdBQUFFLG9CQUFBLEdBQUFDLG9CQUFBLEdBQUFDLGdCQUFBQyxNQUNBLE1BQ0EsS0FBQSxVQUNBLEdBQUFDLG1CQUFBLEdBQUFDLG1CQUFBLEdBQUFDLGNBQUFSLEVBQUEsS0FBQUss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TUFwRixFQUFBUSxVQUFBMkUsTUFBQUMsR0FJQSxPQUNBaEMsUUFBQUEsRUFDQWEsa0JBQUFBIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBSb3V0ZXIgPSBmdW5jdGlvbiAoKVxue1xuICAgIGJhc2VVcmwgPSBcInByb2plY3Qtd2Vic2hvcC9cIjtcblxuICAgIGZ1bmN0aW9uIHJvdXRlKHVybCwgaGlzdG9yeSlcbiAgICB7XG4gICAgICAgIGlmIChpc0ludGVybmFsKHVybCkgPT0gZmFsc2UpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBwYXJ0aWNsZXMgPSBnZXRQYXJ0aWNsZXModXJsKTtcblxuICAgICAgICBzd2l0Y2gocGFydGljbGVzWzBdKVxuICAgICAgICB7XG4gICAgICAgICAgICBjYXNlIFwiXCI6XG4gICAgICAgICAgICBjYXNlIFwiaW5kZXguaHRtbFwiOlxuICAgICAgICAgICAgY2FzZSBcInByb2R1Y3RzXCI6XG4gICAgICAgICAgICAgICAgbmV3IFByb2R1Y3RzQ29udHJvbGxlcihuZXcgUHJvZHVjdHNWaWV3SGVscGVyKCksIG5ldyBQcm9kdWN0c01vZGVsKCkpLm1haW4oKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJwcm9kdWN0XCI6XG4gICAgICAgICAgICAgICAgbmV3IFByb2R1Y3RDb250cm9sbGVyKG5ldyBQcm9kdWN0Vmlld0hlbHBlcigpLCBuZXcgUHJvZHVjdE1vZGVsKHBhcnRpY2xlc1sxXSkpLm1haW4oKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJyZWdpc3RlclwiOlxuICAgICAgICAgICAgICAgIG5ldyBSZWdpc3RlckNvbnRyb2xsZXIobmV3IFJlZ2lzdGVyVmlld0hlbHBlcigpLCBuZXcgUmVnaXN0ZXJNb2RlbCgpKS5tYWluKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwibG9naW5cIjpcbiAgICAgICAgICAgICAgICBuZXcgTG9naW5Db250cm9sbGVyKG5ldyBMb2dpblZpZXdIZWxwZXIoKSwgbmV3IExvZ2luTW9kZWwoKSkubWFpbigpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImxvZ291dFwiOlxuICAgICAgICAgICAgICAgIG5ldyBMb2dvdXRDb250cm9sbGVyKG5ldyBMb2dvdXRWaWV3SGVscGVyKCksIG5ldyBMb2dvdXRNb2RlbCgpKS5tYWluKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIG5ldyBFcnJvckNvbnRyb2xsZXIobmV3IEVycm9yVmlld0hlbHBlcigpKS5tYWluKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaGlzdG9yeSAhPSBmYWxzZSlcbiAgICAgICAge1xuICAgICAgICAgICAgaWYgKHVybCA9PSBcIlwiKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHVybCA9IFwiaW5kZXguaHRtbFwiO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB3cml0ZUhpc3Rvcnkoe30sIFwiQS1aIEdhbWVzXCIsIHVybClcbiAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCAwKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGlzSW50ZXJuYWwodXJsKVxuICAgIHtcbiAgICAgICAgaWYgKHVybC5pbmRleE9mKFwiaHR0cFwiKSAhPSAtMSB8fCB1cmwuaW5kZXhPZihcImh0dHBzXCIpICE9IC0xIHx8IHVybC5pbmRleE9mKFwid3d3XCIpICE9IC0xKVxuICAgICAgICB7XG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSB1cmw7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldFBhcnRpY2xlcyh1cmwpXG4gICAge1xuICAgICAgICAvLyBSZW1vdmUgdGhlIGZpcnN0IC9cbiAgICAgICAgaWYgKHVybC5pbmRleE9mKFwiL1wiKSA9PSAwKVxuICAgICAgICB7XG4gICAgICAgICAgICB1cmwgPSB1cmwuc3Vic3RyaW5nKDEpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSWYgdGhlcmUgaXMgYSBiYXNlIHVybCBzZXQsIHJlbW92ZSB0aGUgYmFzZSB1cmxcbiAgICAgICAgaWYgKHRoaXMuYmFzZVVybCAhPSBudWxsICYmIHVybC5pbmRleE9mKHRoaXMuYmFzZVVybCkgIT0gLTEpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHVybCA9IHVybC5zdWJzdHJpbmcodXJsLmluZGV4T2YodGhpcy5iYXNlVXJsKSArIHRoaXMuYmFzZVVybC5sZW5ndGgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHVybC5zcGxpdCgvXFwvKC4rKT8vKVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHdyaXRlSGlzdG9yeShvYmplY3QsIHRpdGxlLCB1cmwpXG4gICAge1xuICAgICAgICB3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUob2JqZWN0LCB0aXRsZSwgdXJsKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICByb3V0ZTogcm91dGVcbiAgICB9XG59IiwidmFyIExvZ2luTW9kZWwgPSBmdW5jdGlvbigpXG57XG4gICAgZnVuY3Rpb24gbG9naW4oZW1haWwsIHBhc3N3b3JkLCBjYWxsYmFjaylcbiAgICB7XG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB1cmw6IFwiaHR0cDovLy84NC44NC4yNDUuMjk6MjQzL3VzZXIvbG9naW5cIixcbiAgICAgICAgICAgIHR5cGU6IFwicG9zdFwiLFxuICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICBlbWFpbCA6IGVtYWlsLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkIDogcGFzc3dvcmRcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAvLyBwdXQgdG9rZW4gaW4gY29va2llXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuY29va2llPSdhY2Nlc3NfdG9rZW49JyArIGRhdGEuYWNjZXNzX3Rva2VuO1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmNvb2tpZT0ndXNlcl9pZD0nICsgZGF0YS51c2VyX2lkO1xuXG4gICAgICAgICAgICAgICAgLy8gbGV0IGNvbnRyb2xsZXIgcmVzdW1lIHdpdGggc3R1ZmZcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhkYXRhKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKHhociwgc3RhdHVzLCBlcnJvcikge1xuICAgICAgICAgICAgICAgIC8vIHNob3cgJ25vdCBnb29kIGVtYWlsIG9yIHBhc3N3b3JkIHRvIHVzZXInXG4gICAgICAgICAgICAgICAgJChcIiNlcnJvcl9tZXNzYWdlXCIpLnNob3coKTtcblxuICAgICAgICAgICAgICAgIC8vJChcIiNjb21wb25lbnRcIikuaHRtbChcImVycm9yIGZ1bmN0aW9uXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gdGhlIG1ldGhvZHMgdGhhdCBjYW4gYmUgdXNlZCBieSBvdGhlciBwcm9ncmFtcyAodGhlIGNvbnRyb2xsZXIgaW4gdGhpcyBjYXNlKVxuICAgIHJldHVybiB7XG4gICAgICAgIGxvZ2luOiBsb2dpblxuICAgIH1cbn07IiwidmFyIExvZ291dE1vZGVsID0gZnVuY3Rpb24oKVxue1xuICAgIGZ1bmN0aW9uIGxvZ291dChjYWxsYmFjaylcbiAgICB7XG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB1cmw6IFwiaHR0cDovLzg0Ljg0LjI0NS4yOToyNDMvdXNlci9sb2dvdXRcIiwgLy8/IGh0dHA6Ly84NC44NC4yNDUuMjk6MjQzID0gQVBJLWxvY2F0aWU/XG4gICAgICAgICAgICB0eXBlOiBcInBvc3RcIixcbiAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgdXNlcl9pZDogZ2V0Q29va2llKFwidXNlcl9pZFwiKVxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgIC8vIGxldCBjb250cm9sbGVyIHJlc3VtZSB3aXRoIHN0dWZmXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuY29va2llPSdhY2Nlc3NfdG9rZW49JztcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5jb29raWU9J3VzZXJfaWQ9JztcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhkYXRhKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKHhociwgc3RhdHVzLCBlcnJvcikge1xuICAgICAgICAgICAgICAgIC8vIHNob3cgJ25vdCBnb29kIGVtYWlsIG9yIHBhc3N3b3JkIHRvIHVzZXInXG4gICAgICAgICAgICAgICAgJChcIiNlcnJvcl9tZXNzYWdlXCIpLnNob3coKTtcblxuICAgICAgICAgICAgICAgIC8vJChcIiNjb21wb25lbnRcIikuaHRtbChcImVycm9yIGZ1bmN0aW9uXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBmdW5jdGlvbiBnZXRDb29raWUobmFtZSlcbiAgICAgICAge1xuICAgICAgICAgICAgdmFyIGNvb2tpZXMgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsnKTtcblxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb29raWVzLmxlbmd0aDsgaSsrKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhciBjb29raWUgPSBjb29raWVzW2ldLnNwbGl0KFwiPVwiKTtcblxuICAgICAgICAgICAgICAgIGlmIChjb29raWVbMF0udHJpbSgpID09IG5hbWUpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29va2llWzFdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIFJldHVybiB0aGUgbWV0aG9kcyB0aGF0IGNhbiBiZSB1c2VkIGJ5IG90aGVyIHByb2dyYW1zICh0aGUgY29udHJvbGxlciBpbiB0aGlzIGNhc2UpXG4gICAgcmV0dXJuIHtcbiAgICAgICAgbG9nb3V0OiBsb2dvdXRcbiAgICB9XG59OyIsInZhciBQYWdlTW9kZWwgPSBmdW5jdGlvbigpXG57XG4gICAgZnVuY3Rpb24gZ2V0UGFnZShjYWxsYmFjaylcbiAgICB7XG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB1cmw6IFwiaHR0cDovLzg0Ljg0LjI0NS4yOToyNDMvdXNlclwiLFxuICAgICAgICAgICAgdHlwZTogXCJnZXRcIixcbiAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgXCJBdXRob3JpemF0aW9uXCI6IFwiQmVhcmVyIFwiICsgZ2V0Q29va2llKFwiYWNjZXNzX3Rva2VuXCIpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhkYXRhKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKHhociwgc3RhdHVzLCBlcnJvcikge1xuICAgICAgICAgICAgICAgICQoXCIjY29tcG9uZW50XCIpLmxvYWQoXCIvZXJyb3IuaHRtbFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0Q29va2llKG5hbWUpXG4gICAge1xuICAgICAgICB2YXIgY29va2llcyA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgnOycpO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY29va2llcy5sZW5ndGg7IGkrKylcbiAgICAgICAge1xuICAgICAgICAgICAgdmFyIGNvb2tpZSA9IGNvb2tpZXNbaV0uc3BsaXQoXCI9XCIpO1xuXG4gICAgICAgICAgICBpZiAoY29va2llWzBdID09IG5hbWUpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvb2tpZVsxXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIFJldHVybiB0aGUgbWV0aG9kcyB0aGF0IGNhbiBiZSB1c2VkIGJ5IG90aGVyIHByb2dyYW1zICh0aGUgY29udHJvbGxlciBpbiB0aGlzIGNhc2UpXG4gICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0UGFnZTogZ2V0UGFnZVxuICAgIH1cbn07IiwidmFyIFByb2R1Y3RzTW9kZWwgPSBmdW5jdGlvbigpXG57XG4gICAgZnVuY3Rpb24gZ2V0UGFnZShmaWx0ZXIsIGNhbGxiYWNrKVxuICAgIHtcbiAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgIHVybDogXCJodHRwOi8vODQuODQuMjQ1LjI5OjI0My9wcm9kdWN0cz9cIiArIGZpbHRlciwgLy8/IGh0dHA6Ly84NC44NC4yNDUuMjk6MjQzID0gQVBJLWxvY2F0aWU/XG4gICAgICAgICAgICB0eXBlOiBcImdldFwiLFxuICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZGF0YSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICh4aHIsIHN0YXR1cywgZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAkKFwiI2NvbXBvbmVudFwiKS5sb2FkKFwidmlld3MvZXJyb3IvZXJyb3IuaHRtbFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gUmV0dXJuIHRoZSBtZXRob2RzIHRoYXQgY2FuIGJlIHVzZWQgYnkgb3RoZXIgcHJvZ3JhbXMgKHRoZSBjb250cm9sbGVyIGluIHRoaXMgY2FzZSlcbiAgICByZXR1cm4ge1xuICAgICAgICBnZXRQYWdlOiBnZXRQYWdlXG4gICAgfVxufTsiLCJ2YXIgUmVnaXN0ZXJNb2RlbCA9IGZ1bmN0aW9uKClcbntcbiAgICBmdW5jdGlvbiByZWdpc3Rlcihmb3JtRGF0YSwgY2FsbGJhY2spXG4gICAge1xuICAgICAgICBjb25zb2xlLmxvZyhmb3JtRGF0YSk7XG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB1cmw6IFwiaHR0cDovLzg0Ljg0LjI0NS4yOToyNDMvdXNlci9yZWdpc3RlclwiLCAvL2h0dHA6Ly9sb2NhbGhvc3Q6ODA4MC91c2VyL3JlZ2lzdGVyXG4gICAgICAgICAgICB0eXBlOiBcInBvc3RcIixcbiAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgZV9tYWlsIDogZm9ybURhdGEuZV9tYWlsYWRyZXMsXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQgOiBmb3JtRGF0YS53YWNodHdvb3JkLFxuICAgICAgICAgICAgICAgIGZpcnN0X25hbWUgOiBmb3JtRGF0YS52b29ybmFhbSxcbiAgICAgICAgICAgICAgICBzdXJuYW1lIDogZm9ybURhdGEuYWNodGVybmFhbSxcbiAgICAgICAgICAgICAgICBnZW5kZXIgOiBmb3JtRGF0YS5nZW5kZXIsXG4gICAgICAgICAgICAgICAgZGF0ZV9vZl9iaXJ0aCA6IGZvcm1EYXRhLmJpcnRoX2RhdGUsXG4gICAgICAgICAgICAgICAgcGhvbmVfbnVtYmVyIDogZm9ybURhdGEubW9iaWVsX251bW1lcixcbiAgICAgICAgICAgICAgICBzZWNyZXRfcXVlc3Rpb24gOiBmb3JtRGF0YS5zZWN1cml0eV9xdWVzdGlvbixcbiAgICAgICAgICAgICAgICBzZWNyZXRfcXVlc3Rpb25fYW5zd2VyIDogZm9ybURhdGEuc2VjdXJpdHlfYW5zd2VyXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgLy8gbGV0IGNvbnRyb2xsZXIgcmVzdW1lIHdpdGggc3R1ZmZcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhkYXRhKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKHhociwgc3RhdHVzLCBlcnJvcikge1xuICAgICAgICAgICAgICAgIC8vIHNob3cgJ2VtYWlsIGFsIGdlYm9uZGVuIGFhbiBlZW4gYWNjb3VudD8nXG4gICAgICAgICAgICAgICAgJChcIiNyZWdpX2FwaV9lcnJvcl9tZXNzYWdlXCIpLnNob3coKTtcbiAgICAgICAgICAgICAgICAvLyQoXCIjY29tcG9uZW50XCIpLmh0bWwoXCJlcnJvciBmdW5jdGlvblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gUmV0dXJuIHRoZSBtZXRob2RzIHRoYXQgY2FuIGJlIHVzZWQgYnkgb3RoZXIgcHJvZ3JhbXMgKHRoZSBjb250cm9sbGVyIGluIHRoaXMgY2FzZSlcbiAgICByZXR1cm4ge1xuICAgICAgICByZWdpc3RlcjogcmVnaXN0ZXJcbiAgICB9XG59OyIsInZhciBQcm9kdWN0TW9kZWwgPSBmdW5jdGlvbihlYW4pXG57XG4gICAgZnVuY3Rpb24gR2V0UHJvZHVjdEluZm8oY2FsbGJhY2spXG4gICAge1xuICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgdXJsOiBcImh0dHA6Ly84NC44NC4yNDUuMjk6MjQzL3Byb2R1Y3RzL1wiICsgZWFuLCAvL2h0dHA6Ly9sb2NhbGhvc3Q6ODA4MC91c2VyL3JlZ2lzdGVyXG4gICAgICAgICAgICB0eXBlOiBcImdldFwiLFxuICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgLy8gbGV0IGNvbnRyb2xsZXIgcmVzdW1lIHdpdGggc3R1ZmZcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhkYXRhWzBdKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKHhociwgc3RhdHVzLCBlcnJvcikge1xuICAgICAgICAgICAgICAgICQoXCIjY29tcG9uZW50XCIpLmxvYWQoXCIvZXJyb3IuaHRtbFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gUmV0dXJuIHRoZSBtZXRob2RzIHRoYXQgY2FuIGJlIHVzZWQgYnkgb3RoZXIgcHJvZ3JhbXMgKHRoZSBjb250cm9sbGVyIGluIHRoaXMgY2FzZSlcbiAgICByZXR1cm4ge1xuICAgICAgICBHZXRQcm9kdWN0SW5mbzogR2V0UHJvZHVjdEluZm9cbiAgICB9XG59OyIsInZhciBFcnJvckNvbnRyb2xsZXIgPSBmdW5jdGlvbih2aWV3SGVscGVyKVxue1xuICAgIHZhciBWaWV3SGVscGVyID0gdmlld0hlbHBlcjtcblxuICAgIC8vIE1haW4gZnVuY3Rpb24sIGFsc28gdGhlIHN0YXJ0IHN0YXJ0cG9pbnQgZm9yIGEgcGFnZVxuICAgIGZ1bmN0aW9uIG1haW4oKVxuICAgIHtcbiAgICAgICAgLy8gc2V0IHZpZXcgdG8gbG9naW4gZm9ybVxuICAgICAgICBWaWV3SGVscGVyLnNldFZpZXcoKTtcbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gdGhlIG1ldGhvZHMgdGhhdCBjYW4gYmUgdXNlZCBieSBvdGhlciBwcm9ncmFtcyAodGhlIGNvbnRyb2xsZXIgaW4gdGhpcyBjYXNlKVxuICAgIHJldHVybiB7XG4gICAgICAgIG1haW46IG1haW5cbiAgICB9XG59OyIsInZhciBMb2dpbkNvbnRyb2xsZXIgPSBmdW5jdGlvbih2aWV3SGVscGVyLCBtb2RlbClcbntcbiAgICB2YXIgTW9kZWwgICAgICA9IG1vZGVsO1xuICAgIHZhciBWaWV3SGVscGVyID0gdmlld0hlbHBlcjtcbiAgICBcbiAgICAvLyBGdW5jdGlvbiB0aGF0IGlzIGV4ZWN1dGVkIG9uIGEgYWN0aW9uIGxpc3RlbmVyXG4gICAgZnVuY3Rpb24gYWN0aW9uUGVyZm9ybWVkKGV2ZW50KVxuICAgIHtcbiAgICAgICAgLy8gUHJldmVudCBzZW5kaW5nIHRoZSBmb3JtXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgLy8gTG9vcCB0cm91Z2ggdGhlIGZvcm0gZGF0YSBhbmQgZ2V0IGFsbCBmaWVsZHNcbiAgICAgICAgdmFyIGZvcm1EYXRhID0ge307XG4gICAgICAgICQuZWFjaCgkKHRoaXMpLnNlcmlhbGl6ZUFycmF5KCksIGZ1bmN0aW9uIChpLCBmaWVsZCkge1xuICAgICAgICAgICAgZm9ybURhdGFbZmllbGQubmFtZV0gPSBmaWVsZC52YWx1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gbGV0IG1vZGVsIHNlbmQgZW1haWwgYW5kIHBhc3N3b3JkIHRvIEFQSVxuICAgICAgICBNb2RlbC5sb2dpbihmb3JtRGF0YS5lbWFpbCwgZm9ybURhdGEucGFzc3dvcmQsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAvLyBzaG93IHVpdGxvZ2dlbiBidXR0b25cbiAgICAgICAgICAgICQoXCIjaW5sb2dnZW5fdGV4dFwiKS5oaWRlKCk7XG4gICAgICAgICAgICAkKFwiI3VpdGxvZ2dlbl90ZXh0XCIpLnNob3coKTtcblxuICAgICAgICAgICAgLy8gV2VlcmdlZWYgZWVuIGFuZGVyZSBwYWdpbmEgZ2ViYXNzZWVyZCBvcCAnYWRtaW4nIG9mICdyZWdpc3RlcmVkIHVzZXInXG4gICAgICAgICAgICBuZXcgUGFnZUNvbnRyb2xsZXIobmV3IFBhZ2VWaWV3SGVscGVyKCksIG5ldyBQYWdlTW9kZWwoKSkubWFpbigpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBNYWluIGZ1bmN0aW9uLCBhbHNvIHRoZSBzdGFydCBzdGFydHBvaW50IGZvciBhIHBhZ2VcbiAgICBmdW5jdGlvbiBtYWluKClcbiAgICB7XG4gICAgICAgIC8vIHNldCB2aWV3IHRvIGxvZ2luIGZvcm1cbiAgICAgICAgVmlld0hlbHBlci5zZXRWaWV3KCk7XG5cbiAgICAgICAgLy8gdXNlciBmaWxscyBpbiBlbWFpbCBhbmQgcGFzc3dvcmQ7IGNsaWNrcyAnbG9naW4nOiBWSUVXIG5vdGljZXMgdGhpcyBhbmQgcmVhY3RzXG4gICAgICAgIFZpZXdIZWxwZXIuc2V0QWN0aW9uTGlzdGVuZXIoYWN0aW9uUGVyZm9ybWVkKTtcbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gdGhlIG1ldGhvZHMgdGhhdCBjYW4gYmUgdXNlZCBieSBvdGhlciBwcm9ncmFtcyAodGhlIGNvbnRyb2xsZXIgaW4gdGhpcyBjYXNlKVxuICAgIHJldHVybiB7XG4gICAgICAgIG1haW46IG1haW5cbiAgICB9XG59OyIsInZhciBMb2dvdXRDb250cm9sbGVyID0gZnVuY3Rpb24odmlld0hlbHBlciwgbW9kZWwpXG57XG4gICAgdmFyIE1vZGVsICAgICAgPSBtb2RlbDtcbiAgICB2YXIgVmlld0hlbHBlciA9IHZpZXdIZWxwZXI7XG4gICAgXG4gICAgLy8gRnVuY3Rpb24gdGhhdCBpcyBleGVjdXRlZCBvbiBhIGFjdGlvbiBsaXN0ZW5lclxuICAgIGZ1bmN0aW9uIGFjdGlvblBlcmZvcm1lZChldmVudClcbiAgICB7XG4gICAgICAgIE1vZGVsLmxvZ291dChmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgLy8gc2hvdyB1aXRsb2dnZW4gYnV0dG9uXG4gICAgICAgICAgICAkKFwiI2lubG9nZ2VuX3RleHRcIikuc2hvdygpO1xuICAgICAgICAgICAgJChcIiN1aXRsb2dnZW5fdGV4dFwiKS5oaWRlKCk7XG5cbiAgICAgICAgICAgIC8vIHNldCB2aWV3IHRvIGxvZ2luIGZvcm1cbiAgICAgICAgICAgIFZpZXdIZWxwZXIuc2V0VmlldygpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBNYWluIGZ1bmN0aW9uLCBhbHNvIHRoZSBzdGFydCBzdGFydHBvaW50IGZvciBhIHBhZ2VcbiAgICBmdW5jdGlvbiBtYWluKClcbiAgICB7XG4gICAgICAgIC8vIHVzZXIgZmlsbHMgaW4gZW1haWwgYW5kIHBhc3N3b3JkOyBjbGlja3MgJ2xvZ2luJzogVklFVyBub3RpY2VzIHRoaXMgYW5kIHJlYWN0c1xuICAgICAgICBWaWV3SGVscGVyLnNldEFjdGlvbkxpc3RlbmVyKGFjdGlvblBlcmZvcm1lZCk7XG4gICAgfVxuXG4gICAgLy8gUmV0dXJuIHRoZSBtZXRob2RzIHRoYXQgY2FuIGJlIHVzZWQgYnkgb3RoZXIgcHJvZ3JhbXMgKHRoZSBjb250cm9sbGVyIGluIHRoaXMgY2FzZSlcbiAgICByZXR1cm4ge1xuICAgICAgICBtYWluOiBtYWluXG4gICAgfVxufTsiLCJ2YXIgUGFnZUNvbnRyb2xsZXIgPSBmdW5jdGlvbih2aWV3SGVscGVyLCBtb2RlbClcbntcbiAgICB2YXIgTW9kZWwgPSBtb2RlbDtcbiAgICB2YXIgVmlldyAgPSB2aWV3SGVscGVyO1xuICAgIFxuICAgIC8vIEZ1bmN0aW9uIHRoYXQgaXMgZXhlY3V0ZWQgb24gYSBhY3Rpb24gbGlzdGVuZXJcbiAgICBmdW5jdGlvbiBhY3Rpb25QZXJmb3JtZWQoZXZlbnQpXG4gICAge1xuICAgICAgICBNb2RlbC5nZXRQYWdlKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBWaWV3LnNldFZpZXcoZGF0YSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIE1haW4gZnVuY3Rpb24sIGFsc28gdGhlIHN0YXJ0IHN0YXJ0cG9pbnQgZm9yIGEgcGFnZVxuICAgIGZ1bmN0aW9uIG1haW4oKVxuICAgIHsgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgVmlldy5zZXRBY3Rpb25MaXN0ZW5lcihhY3Rpb25QZXJmb3JtZWQpO1xuICAgIH1cblxuICAgIC8vIFJldHVybiB0aGUgbWV0aG9kcyB0aGF0IGNhbiBiZSB1c2VkIGJ5IG90aGVyIHByb2dyYW1zICh0aGUgY29udHJvbGxlciBpbiB0aGlzIGNhc2UpXG4gICAgcmV0dXJuIHtcbiAgICAgICAgbWFpbjogbWFpblxuICAgIH1cbn07IiwidmFyIFByb2R1Y3RzQ29udHJvbGxlciA9IGZ1bmN0aW9uKHZpZXdIZWxwZXIsIG1vZGVsKVxue1xuICAgIHZhciBNb2RlbCAgICAgID0gbW9kZWw7XG4gICAgdmFyIFZpZXdIZWxwZXIgPSB2aWV3SGVscGVyO1xuICAgIFxuICAgIC8vIEZ1bmN0aW9uIHRoYXQgaXMgZXhlY3V0ZWQgb24gYSBhY3Rpb24gbGlzdGVuZXJcbiAgICBmdW5jdGlvbiBnZXRQYWdlKClcbiAgICB7XG4gICAgICAgIE1vZGVsLmdldFBhZ2UoXCJcIiwgZnVuY3Rpb24gKGRhdGEpIHsgVmlld0hlbHBlci5zZXRWaWV3KGRhdGEpOyB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBmaWx0ZXJQcm9kdWN0cyhldmVudClcbiAgICB7XG4gICAgICAgIC8vIFByZXZlbnQgc2VuZGluZyB0aGUgZm9ybSAocGFnZSByZWxvYWQpXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgdmFyIGZpbHRlcnMgPSAkKHRoaXMpLnNlcmlhbGl6ZSgpO1xuICAgICAgICBNb2RlbC5nZXRQYWdlKGZpbHRlcnMsIGZ1bmN0aW9uIChkYXRhKSB7IFZpZXdIZWxwZXIubG9hZFByb2R1Y3RzKGRhdGEpOyB9KTtcbiAgICB9XG5cbiAgICAvLyBNYWluIGZ1bmN0aW9uLCBhbHNvIHRoZSBzdGFydCBzdGFydHBvaW50IGZvciBhIHBhZ2VcbiAgICBmdW5jdGlvbiBtYWluKClcbiAgICB7ICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgIFZpZXdIZWxwZXIuc2V0QWN0aW9uTGlzdGVuZXIoZ2V0UGFnZSk7XG4gICAgICAgIFZpZXdIZWxwZXIuc2V0RmlsdGVyTGlzdGVuZXIoZmlsdGVyUHJvZHVjdHMpO1xuICAgICAgICAvLyBuZXcgYWN0aW9uIHdhbm5lciBlciBvcCBmaWx0ZXIgd29yZHQgZ2VkcnVrdFxuICAgIH1cblxuICAgIC8vIFJldHVybiB0aGUgbWV0aG9kcyB0aGF0IGNhbiBiZSB1c2VkIGJ5IG90aGVyIHByb2dyYW1zICh0aGUgY29udHJvbGxlciBpbiB0aGlzIGNhc2UpXG4gICAgcmV0dXJuIHtcbiAgICAgICAgbWFpbjogbWFpblxuICAgIH1cbn07IiwidmFyIFJlZ2lzdGVyQ29udHJvbGxlciA9IGZ1bmN0aW9uKHZpZXdIZWxwZXIsIG1vZGVsKVxue1xuICAgIHZhciBNb2RlbCAgICAgID0gbW9kZWw7XG4gICAgdmFyIFZpZXdIZWxwZXIgPSB2aWV3SGVscGVyO1xuICAgIFxuICAgIC8vIEZ1bmN0aW9uIHRoYXQgaXMgZXhlY3V0ZWQgb24gYSBhY3Rpb24gbGlzdGVuZXJcbiAgICBmdW5jdGlvbiBhY3Rpb25QZXJmb3JtZWQoKVxuICAgIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJpbiBhY3Rpb25QZXJmb3JtZWRcIik7IC8vdGVzdFxuXG4gICAgICAgIC8vIFByZXZlbnQgc2VuZGluZyB0aGUgZm9ybVxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIC8vIHJlc2V0IGVycm9yIG1lc3NhZ2VzXG4gICAgICAgICQoXCIjcmVnaV9hcGlfZXJyb3JfbWVzc2FnZVwiKS5oaWRlKCk7XG4gICAgICAgICQoXCIjd3cyX2Vycm9yX21lc3NhZ2VcIikuaGlkZSgpO1xuXG4gICAgICAgIC8vIHB1dCBmb3JtIGZpZWxkcyBpbiBqYXZhc2NyaXB0IE9iamVjdFxuICAgICAgICB2YXIgZm9ybURhdGEgPSB7fTtcblxuICAgICAgICAkLmVhY2goJCh0aGlzKS5zZXJpYWxpemVBcnJheSgpLCBmdW5jdGlvbiAoaSwgZmllbGQpIHtcbiAgICAgICAgICAgIGZvcm1EYXRhW2ZpZWxkLm5hbWVdID0gZmllbGQudmFsdWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGZpeCBkYXRlIG9mIGJpcnRoIChBUEkgZXhwZWN0cyBjZXJ0YWluIGZvcm1hdClcbiAgICAgICAgZm9ybURhdGFbXCJiaXJ0aF9kYXRlXCJdID0gZm9ybURhdGEuamFhciArIFwiLVwiICsgZm9ybURhdGEubWFhbmQgKyBcIi1cIiArIGZvcm1EYXRhLmRhZztcblxuICAgICAgICAvLyBjaGVjayB3aGV0aGVyIGFueSBtYW5kYXRvcnkgZmllbGQgaXMgbGVmdCBlbXB0eSBieSB1c2VyIGFuZFxuICAgICAgICAvLyBpZiBzbywgYWJvcnQgZnVuY3Rpb25cbiAgICAgICAgdmFyIG1hbmRhdG9yeUZpZWxkTWlzc2VzID0gZmFsc2U7XG4gICAgICAgIHZhciBtYW5kYXRvcnlGaWVsZHMgPSBbXCJ2b29ybmFhbVwiLCBcImFjaHRlcm5hYW1cIiwgXCJwb3N0Y29kZVwiLCBcImh1aXNudW1tZXJcIiwgXCJlX21haWxhZHJlc1wiLCBcIndhY2h0d29vcmRcIiwgXCJ3YWNodHdvb3JkMlwiLCBcInNlY3VyaXR5X2Fuc3dlclwiXTsgLy9kcm9wZG93bnMgKGxpa2UgZ2VuZGVyKSBhcmUgYWx3YXlzIGZpbGxlZCBpbiwgc28gZG9uJ3QgcHV0IGluIHRoaXMgbGlzdFxuXG4gICAgICAgIC8vIChyZXNldCBhbGwgZmllbGRzIHRvICd2YWxpZCcgYmVjYXVzZSB1c2VyIG1heSBoYXZlIGZpbGxlZCBpbiBmaWVsZHMgc2luY2VcbiAgICAgICAgLy8gdGhlIHByZXZpb3VzIHRpbWUgdGhpcyBmdW5jdGlvbiB3YXMgY2FsbGVkKVxuICAgICAgICAkLmVhY2gobWFuZGF0b3J5RmllbGRzLCBmdW5jdGlvbiAoaSwgbWFuRmllbGQpIHtcbiAgICAgICAgICAgICQoXCIjXCIgKyBtYW5GaWVsZCkucmVtb3ZlQ2xhc3MoXCJpbnZhbGlkXCIpO1xuICAgICAgICB9KVxuXG4gICAgICAgICQuZWFjaChtYW5kYXRvcnlGaWVsZHMsIGZ1bmN0aW9uIChpLCBtYW5GaWVsZCkge1xuICAgICAgICAgICAgaWYgKGZvcm1EYXRhW21hbkZpZWxkXSA9PSBcIlwiKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICQoXCIjXCIgKyBtYW5GaWVsZCkuYWRkQ2xhc3MoXCJpbnZhbGlkXCIpO1xuXG4gICAgICAgICAgICAgICAgbWFuZGF0b3J5RmllbGRNaXNzZXMgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG4gICAgICAgIFxuICAgICAgICAvLyBpZiBhIG1hbmRhdG9yeSBmaWVsZCBpcyBlbXB0eSwgc2hvdyBlcnJvciBtZXNzYWdlIHRvIHVzZXIgYW5kIGFib3J0IGZ1bmN0aW9uXG4gICAgICAgIGlmIChtYW5kYXRvcnlGaWVsZE1pc3NlcylcbiAgICAgICAgeyBcbiAgICAgICAgICAgIC8vIHNjcm9sbCB0byB0b3Agb2YgcGFnZSBzbyB0aGF0IHVzZXJzIHNlZSBtZXNzYWdlIFwic29tZXRoaW5nIGlzIG5vdCBmaWxsZWQgaW5cIlxuICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDApO1xuICAgICAgICAgICAgLy8gc2hvdyBtZXNzYWdlIFwic29tZXRoaW5nIGlzIG5vdCBmaWxsZWQgaW5cIlxuICAgICAgICAgICAgJChcIiNyZWdpc3Rlcl9lcnJvcl9tZXNzYWdlXCIpLnNob3coKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgcGFzc3dvcmRzTm90SWRlbnRpY2FsID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKGZvcm1EYXRhLndhY2h0d29vcmQgIT0gZm9ybURhdGEud2FjaHR3b29yZDIpIFxuICAgICAgICB7XG4gICAgICAgICAgICBwYXNzd29yZHNOb3RJZGVudGljYWwgPSB0cnVlO1xuICAgICAgICAgICAgJChcIiN3dzJfZXJyb3JfbWVzc2FnZVwiKS5zaG93KCk7XG4gICAgICAgICAgICAkKFwiI3dhY2h0d29vcmRcIikuYWRkQ2xhc3MoXCJpbnZhbGlkXCIpO1xuICAgICAgICAgICAgJChcIiN3YWNodHdvb3JkMlwiKS5hZGRDbGFzcyhcImludmFsaWRcIik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBhYm9ydCBmdW5jdGlvbiBpZiBtYW5kYXRvcnkgZmllbGQgbWlzc2VzIG9yIHBhc3N3b3JkcyBub3QgaWRlbnRpY2FsXG4gICAgICAgIGlmIChtYW5kYXRvcnlGaWVsZE1pc3NlcyB8fCBwYXNzd29yZHNOb3RJZGVudGljYWwpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGxldCBtb2RlbCBzZW5kIHVzZXIgaW5mbyB0byBBUElcbiAgICAgICAgTW9kZWwucmVnaXN0ZXIoZm9ybURhdGEsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBWaWV3SGVscGVyLnNldFZpZXcoJy92aWV3cy9yZWdpc3Rlci9hZnRlcl9yZWdpc3Rlci5odG1sJyk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIE1haW4gZnVuY3Rpb24sIGFsc28gdGhlIHN0YXJ0IHN0YXJ0cG9pbnQgZm9yIGEgcGFnZVxuICAgIGZ1bmN0aW9uIG1haW4oKVxuICAgIHtcbiAgICAgICAgLy8gc2V0IHZpZXcgdG8gcmVnaXN0ZXIgZm9ybVxuICAgICAgICBWaWV3SGVscGVyLnNldFZpZXcoJy92aWV3cy9yZWdpc3Rlci9yZWdpc3Rlci5odG1sJyk7XG5cbiAgICAgICAgLy8gdXNlciBmaWxscyBpbiByZWdpc3RlciBpbmZvOyBjbGlja3MgJ3JlZ2lzdGVyJzogdmlldyBub3RpY2VzIHRoaXMgYW5kIHJlYWN0c1xuICAgICAgICBWaWV3SGVscGVyLnNldEFjdGlvbkxpc3RlbmVyKGFjdGlvblBlcmZvcm1lZCk7XG5cbiAgICAgICAgLy8gZW1haWwgYW5kIHBhc3N3b3JkIGFyZSBzZW5kIHRvIEFQSTsgQVBJIGNoZWNrcyBpZiBlbWFpbCBhbHJlYWR5IGV4aXN0cyAoYW5kIHdoZXRoZXIgcGFzc3dvcmQgaXMgY29ycmVjdD8pIFxuICAgIH1cblxuICAgIC8vIFJldHVybiB0aGUgbWV0aG9kcyB0aGF0IGNhbiBiZSB1c2VkIGJ5IG90aGVyIHByb2dyYW1zICh0aGUgY29udHJvbGxlciBpbiB0aGlzIGNhc2UpXG4gICAgcmV0dXJuIHtcbiAgICAgICAgbWFpbjogbWFpblxuICAgIH1cbn07IiwidmFyIFByb2R1Y3RDb250cm9sbGVyID0gZnVuY3Rpb24odmlld0hlbHBlciwgbW9kZWwpXG57XG4gICAgdmFyIE1vZGVsICAgICAgPSBtb2RlbDtcbiAgICB2YXIgVmlld0hlbHBlciA9IHZpZXdIZWxwZXI7XG4gICAgXG4gICAgLy8gRnVuY3Rpb24gdGhhdCBpcyBleGVjdXRlZCBvbiBhIGFjdGlvbiBsaXN0ZW5lclxuICAgIGZ1bmN0aW9uIGFjdGlvblBlcmZvcm1lZChldmVudClcbiAgICB7XG4gICAgICAgIG1vZGVsLkdldFByb2R1Y3RJbmZvKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICB2aWV3SGVscGVyLnNldFZpZXcoZGF0YSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIE1haW4gZnVuY3Rpb24sIGFsc28gdGhlIHN0YXJ0IHN0YXJ0cG9pbnQgZm9yIGEgcGFnZVxuICAgIGZ1bmN0aW9uIG1haW4oKVxuICAgIHtcbiAgICAgICAgdmlld0hlbHBlci5zZXRBY3Rpb25MaXN0ZW5lcihhY3Rpb25QZXJmb3JtZWQpO1xuICAgIH1cblxuICAgIC8vIFJldHVybiB0aGUgbWV0aG9kcyB0aGF0IGNhbiBiZSB1c2VkIGJ5IG90aGVyIHByb2dyYW1zICh0aGUgY29udHJvbGxlciBpbiB0aGlzIGNhc2UpXG4gICAgcmV0dXJuIHtcbiAgICAgICAgbWFpbjogbWFpbixcbiAgICB9XG59OyIsInZhciBFcnJvclZpZXdIZWxwZXIgPSBmdW5jdGlvbigpXG57XG4gICAgLy8gQ2hhbmdlIHRoZSB2aWV3IG9mIHRoZSBwYWdlXG4gICAgZnVuY3Rpb24gc2V0VmlldygpXG4gICAge1xuICAgICAgICAkKFwiI2NvbXBvbmVudFwiKS5sb2FkKCcvdmlld3MvZXJyb3IvZXJyb3IuaHRtbCcpO1xuICAgIH1cblxuICAgIC8vIEFjdGlvbkxpc3RlbmVyIHRoYXQgZXhlY3V0ZXMgYWN0aW9ucyBvbiBzcGVjaWZpYyBldmVudHNcbiAgICBmdW5jdGlvbiBzZXRBY3Rpb25MaXN0ZW5lcihldmVudEhhbmRsZXIpXG4gICAge1xuICAgICAgICAkKGRvY3VtZW50KS5yZWFkeShldmVudEhhbmRsZXIpO1xuICAgIH1cblxuICAgIC8vIFJldHVybiB0aGUgbWV0aG9kcyB0aGF0IGNhbiBiZSB1c2VkIGJ5IG90aGVyIHByb2dyYW1zICh0aGUgY29udHJvbGxlciBpbiB0aGlzIGNhc2UpXG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2V0Vmlldzogc2V0VmlldyxcbiAgICAgICAgc2V0QWN0aW9uTGlzdGVuZXI6IHNldEFjdGlvbkxpc3RlbmVyXG4gICAgfVxufTsiLCJ2YXIgTG9naW5WaWV3SGVscGVyID0gZnVuY3Rpb24oKVxue1xuICAgIC8vIENoYW5nZSB0aGUgdmlldyBvZiB0aGUgcGFnZVxuICAgIGZ1bmN0aW9uIHNldFZpZXcoKVxuICAgIHtcbiAgICAgICAgJChcIiNjb21wb25lbnRcIikubG9hZCgnL3ZpZXdzL2xvZ2luL2xvZ2luLmh0bWwnKTtcbiAgICB9XG5cbiAgICAvLyBFeGVjdXRlIHRoZSBldmVudCB3aGVuICdzb21ldGhpbmcnIGhhcHBlbnMgKHdoZW4gYSBidXR0b24gaXMgY2xpY2tlZCBmb3IgZXhhbXBsZSlcbiAgICBmdW5jdGlvbiBzZXRBY3Rpb25MaXN0ZW5lcihhY3Rpb24pXG4gICAge1xuICAgICAgICAvLyB1c2VyIGZpbGxzIGluIGxvZ2luIGZvcm1cbiAgICAgICAgLy8gdXNlciBwcmVzc2VzICdsb2dpbidcblxuICAgICAgICAvLyBpZiB1c2VyIHByZXNzZXMgJ2xvZ2luJywgcGVyZm9ybSBhY3Rpb24gKG1ha2UgY29udHJvbGxlciBzZW5kIGVtYWlsIGFuZCBwYXNzd29yZCB0byBBUEkpXG4gICAgICAgICQoXCIjY29tcG9uZW50XCIpLm9uKFwic3VibWl0XCIsIFwiI2xvZ2luZm9ybVwiLCBhY3Rpb24pO1xuICAgIH1cblxuICAgIC8vIFJldHVybiB0aGUgbWV0aG9kcyB0aGF0IGNhbiBiZSB1c2VkIGJ5IG90aGVyIHByb2dyYW1zICh0aGUgY29udHJvbGxlciBpbiB0aGlzIGNhc2UpXG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2V0Vmlldzogc2V0VmlldyxcbiAgICAgICAgc2V0QWN0aW9uTGlzdGVuZXI6IHNldEFjdGlvbkxpc3RlbmVyXG4gICAgfVxufTsiLCJ2YXIgTG9nb3V0Vmlld0hlbHBlciA9IGZ1bmN0aW9uKClcbntcbiAgICAvLyBDaGFuZ2UgdGhlIHZpZXcgb2YgdGhlIHBhZ2VcbiAgICBmdW5jdGlvbiBzZXRWaWV3KClcbiAgICB7XG4gICAgICAgICQoXCIjY29tcG9uZW50XCIpLmxvYWQoJy92aWV3cy9sb2dvdXQvbG9nb3V0Lmh0bWwnKTtcbiAgICB9XG5cbiAgICAvLyBFeGVjdXRlIHRoZSBldmVudCB3aGVuICdzb21ldGhpbmcnIGhhcHBlbnMgKHdoZW4gYSBidXR0b24gaXMgY2xpY2tlZCBmb3IgZXhhbXBsZSlcbiAgICBmdW5jdGlvbiBzZXRBY3Rpb25MaXN0ZW5lcihhY3Rpb24pXG4gICAge1xuICAgICAgICAkKGRvY3VtZW50KS5yZWFkeShhY3Rpb24pO1xuICAgIH1cblxuICAgIC8vIFJldHVybiB0aGUgbWV0aG9kcyB0aGF0IGNhbiBiZSB1c2VkIGJ5IG90aGVyIHByb2dyYW1zICh0aGUgY29udHJvbGxlciBpbiB0aGlzIGNhc2UpXG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2V0Vmlldzogc2V0VmlldyxcbiAgICAgICAgc2V0QWN0aW9uTGlzdGVuZXI6IHNldEFjdGlvbkxpc3RlbmVyXG4gICAgfVxufTsiLCJ2YXIgUGFnZVZpZXdIZWxwZXIgPSBmdW5jdGlvbigpXG57XG4gICAgLy8gQ2hhbmdlIHRoZSB2aWV3IG9mIHRoZSBwYWdlXG4gICAgZnVuY3Rpb24gc2V0Vmlldyh2aWV3RGF0YSlcbiAgICB7XG4gICAgICAgICQoXCIjY29tcG9uZW50XCIpLmxvYWQoJy92aWV3cy9wYWdlL3BhZ2UuaHRtbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh2aWV3RGF0YVswXS51c2VyX3R5cGUgPT0gXCJjdXN0b21lclwiKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICQoXCIjdXNlci1ibG9ja1wiKS5hcHBlbmQoXCI8aDE+SmUgbGVlcyBkaXQgYWxsZWVuIGFscyBqZSBlZW4gY3VzdG9tZXIgYmVudFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh2aWV3RGF0YVswXS51c2VyX3R5cGUgPT0gXCJhZG1pblwiKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICQoXCIjdXNlci1ibG9ja1wiKS5hcHBlbmQoXCI8aDE+SmUgbGVlcyBkaXQgYWxsZWVuIGFscyBqZSBlZW4gYWRtaW5pc3RyYXRvciBiZW50XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBBY3Rpb25MaXN0ZW5lciB0aGF0IGV4ZWN1dGVzIGFjdGlvbnMgb24gc3BlY2lmaWMgZXZlbnRzXG4gICAgZnVuY3Rpb24gc2V0QWN0aW9uTGlzdGVuZXIoZXZlbnRIYW5kbGVyKVxuICAgIHtcbiAgICAgICAgJChkb2N1bWVudCkucmVhZHkoZXZlbnRIYW5kbGVyKTtcbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gdGhlIG1ldGhvZHMgdGhhdCBjYW4gYmUgdXNlZCBieSBvdGhlciBwcm9ncmFtcyAodGhlIGNvbnRyb2xsZXIgaW4gdGhpcyBjYXNlKVxuICAgIHJldHVybiB7XG4gICAgICAgIHNldFZpZXc6IHNldFZpZXcsXG4gICAgICAgIHNldEFjdGlvbkxpc3RlbmVyOiBzZXRBY3Rpb25MaXN0ZW5lclxuICAgIH1cbn07IiwidmFyIFByb2R1Y3RzVmlld0hlbHBlciA9IGZ1bmN0aW9uKClcbntcbiAgICAvLyBDaGFuZ2UgdGhlIHZpZXcgb2YgdGhlIHBhZ2VcbiAgICBmdW5jdGlvbiBzZXRWaWV3KHZpZXdEYXRhKVxuICAgIHtcbiAgICAgICAgJChcIiNjb21wb25lbnRcIikuaHRtbCgnPGRpdiBjbGFzcz1cImNvbC0xMlwiPjxkaXYgY2xhc3M9XCJjb2wtM1wiIGlkPVwiZmlsdGVyc1wiPjwvZGl2PjxkaXYgY2xhc3M9XCJjb2wtOVwiIGlkPVwicHJvZHVjdHNcIj48L2Rpdj48L2Rpdj4nKTtcbiAgICAgICAgLy8gbG9hZCBmaWx0ZXJzXG4gICAgICAgICQoXCIjZmlsdGVyc1wiKS5sb2FkKCcvdmlld3MvcHJvZHVjdHMvZmlsdGVycy5odG1sJyk7XG5cbiAgICAgICAgLy8gbG9hZCBwcm9kdWN0c1xuICAgICAgICBsb2FkUHJvZHVjdHModmlld0RhdGEpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxvYWRQcm9kdWN0cyh2aWV3RGF0YSlcbiAgICB7XG4gICAgICAgICQoXCIjcHJvZHVjdHNcIikubG9hZCgndmlld3MvcHJvZHVjdHMvcHJvZHVjdHMuaHRtbCcsIGZ1bmN0aW9uICgpIHsgLy8gd2FhciBpZCA9ICdjb21wb25lbnQnIGRvZSAubG9hZC4uLi4uLlxuICAgICAgICAgICAgJC5lYWNoKHZpZXdEYXRhLCBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgLy8gQ2xvbmUgcHJvZHVjdFxuICAgICAgICAgICAgICAgIHZhciBwcm9kdWN0ID0gJCgnPGRpdj4nKS5hcHBlbmQoJCgnI3Byb2R1Y3RfX2xpc3RfX2l0ZW0nKS5jbG9uZSgpKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBBZGQgcHJvZHVjdCBpbmZvXG4gICAgICAgICAgICAgICAgJChwcm9kdWN0KS5maW5kKFwiLnByb2R1Y3RfX3RpdGxlXCIpLmh0bWwodmFsdWUudGl0bGUpO1xuICAgICAgICAgICAgICAgICQocHJvZHVjdCkuZmluZChcIi5wcm9kdWN0X19zdWJ0aXRsZVwiKS5hcHBlbmQodmFsdWUuZ2VucmUgKyhcIiB8IFBFR0kgXCIpICsgdmFsdWUucGVnaV9hZ2UgKyhcIiB8IFwiKSsgUGxhdGZvcm1Mb2dvKHZhbHVlLnBsYXRmb3JtKSk7XG4gICAgICAgICAgICAgICAgJChwcm9kdWN0KS5maW5kKFwiLnByb2R1Y3RfX2Rlc2NyaXB0aW9uXCIpLmh0bWwoQ3V0U3RyaW5nKHZhbHVlLmRlc2NyaXB0aW9uKSk7XG4gICAgICAgICAgICAgICAgJChwcm9kdWN0KS5maW5kKFwiLnByb2R1Y3RfX3ByaWNlXCIpLmFwcGVuZCgoXCLigqwgXCIpK3ZhbHVlLnByaWNlKTtcbiAgICAgICAgICAgICAgICAkKHByb2R1Y3QpLmZpbmQoXCIjYnV0dG9uc19faW5mb1wiKS5hdHRyKFwiaHJlZlwiLCBcInByb2R1Y3QvXCIgKyB2YWx1ZS5lYW5fbnVtYmVyKVxuICAgICAgICAgICAgICAgICQocHJvZHVjdCkuZmluZChcIi5wcm9kdWN0X19pbWFnZSBpbWdcIikuYXR0cihcInNyY1wiLCB2YWx1ZS5pbWFnZSk7XG5cbiAgICAgICAgICAgICAgICAkKFwiI3Byb2R1Y3RfX2xpc3RcIikuYXBwZW5kKHByb2R1Y3QpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIFJlbW92ZSB0aGUgZmlyc3QgbGlzdCBpdGVtLCBiZWNhdXNlIHRoaXMgaXRlbSBpcyBhbHdheXMgZW1wdHlcbiAgICAgICAgICAgICQoXCIjcHJvZHVjdF9fbGlzdF9faXRlbVwiKS5maXJzdCgpLnJlbW92ZSgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvL1Nob3cgbW9yZS9sZXNzXG4gICAgZnVuY3Rpb24gQ3V0U3RyaW5nKHRleHQpe1xuICAgICAgICB2YXIgU2hvd0Ftb3VudCA9IDUwO1xuICAgICAgICB2YXIgV29yZHNBcnJheSA9IHRleHQuc3BsaXQoXCIgXCIpO1xuICAgICAgICBpZihXb3Jkc0FycmF5Lmxlbmd0aD5TaG93QW1vdW50KXtcbiAgICAgICAgICAgIHZhciBTaG9ydFN0cmluZyA9IFwiXCI7XG4gICAgICAgICAgICBmb3IoaT0wOyBpPFNob3dBbW91bnQ7IGkrKyl7XG4gICAgICAgICAgICAgICAgU2hvcnRTdHJpbmcgKz0gV29yZHNBcnJheVtpXSArIFwiIFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFNob3J0U3RyaW5nK1wiLi4uXCI7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgcmV0dXJuIHRleHQ7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLy9QbGF0Zm9ybSBMb2dvJ3NcbiAgICBmdW5jdGlvbiBQbGF0Zm9ybUxvZ28ocGxhdGZvcm1uYWFtKVxuICAgIHtcbiAgICAgICAgcGxhdGZvcm1uYWFtID0gcGxhdGZvcm1uYWFtLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgIHN3aXRjaCAocGxhdGZvcm1uYWFtKVxuICAgICAgICB7XG4gICAgICAgICAgICBjYXNlIFwiUFM0XCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiPGltZyBzcmM9J2h0dHBzOi8vbWF4Y2RuLmljb25zOC5jb20vQW5kcm9pZF9ML1BORy80OC9Mb2dvcy9wbGF5X3N0YXRpb25fY29weXJpZ2h0ZWQtNDgucG5nJyAvPlwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIlBDXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiPGltZyBzcmM9J2h0dHBzOi8vbWF4Y2RuLmljb25zOC5jb20vQ29sb3IvUE5HLzQ4L09wZXJhdGluZ19TeXN0ZW1zL3dpbmRvd3NfbG9nb19jb3B5cmlnaHRlZC00OC5wbmcnIC8+XCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiWEJPWFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcIjxpbWcgc3JjPSdodHRwczovL21heGNkbi5pY29uczguY29tL0NvbG9yL1BORy80OC9Mb2dvcy94Ym94LTQ4LnBuZycgLz5cIjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJOSU5URU5ET1wiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcIjxpbWcgc3JjPSdodHRwczovL21heGNkbi5pY29uczguY29tL0NvbG9yL1BORy80OC9HYW1pbmcvbmludGVuZG8tNDgucG5nJyAvPlwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gcGxhdGZvcm1uYWFtO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gRXhlY3V0ZSB0aGUgZXZlbnQgd2hlbiAnc29tZXRoaW5nJyBoYXBwZW5zICh3aGVuIGEgYnV0dG9uIGlzIGNsaWNrZWQgZm9yIGV4YW1wbGUpXG4gICAgZnVuY3Rpb24gc2V0QWN0aW9uTGlzdGVuZXIoYWN0aW9uKVxuICAgIHtcbiAgICAgICAgJChkb2N1bWVudCkucmVhZHkoYWN0aW9uKTsgLy8gaWYgJ2RvY3VtZW50IHJlYWR5JyBwZXJmb3JtIFwiYWN0aW9uXCJcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzZXRGaWx0ZXJMaXN0ZW5lcihhY3Rpb24pXG4gICAge1xuICAgICAgICAgLy8gSGllciBoZXQgZm9ybXVsaWVyIHZlcnN0dXJlbiBhbHMgd2Ugb3AgZWVuIGNoZWNrYm94IGRydWtrZW5cbiAgICAgICAgJChcIiNjb21wb25lbnRcIikub24oXCJjaGFuZ2VcIiwgXCJpbnB1dFt0eXBlPWNoZWNrYm94XVwiLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgJChcIiNwcm9kdWN0X2ZpbHRlclwiKS5zdWJtaXQoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJChcIiNjb21wb25lbnRcIikub24oXCJzdWJtaXRcIiwgXCIjcHJvZHVjdF9maWx0ZXJcIiwgYWN0aW9uKTtcbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gdGhlIG1ldGhvZHMgdGhhdCBjYW4gYmUgdXNlZCBieSBvdGhlciBwcm9ncmFtcyAodGhlIGNvbnRyb2xsZXIgaW4gdGhpcyBjYXNlKVxuICAgIHJldHVybiB7XG4gICAgICAgIHNldFZpZXc6IHNldFZpZXcsXG4gICAgICAgIGxvYWRQcm9kdWN0czogbG9hZFByb2R1Y3RzLFxuICAgICAgICBzZXRBY3Rpb25MaXN0ZW5lcjogc2V0QWN0aW9uTGlzdGVuZXIsXG4gICAgICAgIHNldEZpbHRlckxpc3RlbmVyOiBzZXRGaWx0ZXJMaXN0ZW5lclxuICAgIH1cbn07IiwidmFyIFJlZ2lzdGVyVmlld0hlbHBlciA9IGZ1bmN0aW9uKClcbntcbiAgICAvLyBDaGFuZ2UgdGhlIHZpZXcgb2YgdGhlIHBhZ2VcbiAgICBmdW5jdGlvbiBzZXRWaWV3KHZpZXdUb1Nob3cpXG4gICAge1xuICAgICAgICAkKFwiI2NvbXBvbmVudFwiKS5sb2FkKHZpZXdUb1Nob3cpO1xuICAgIH1cblxuICAgIC8vIEV4ZWN1dGUgdGhlIGV2ZW50IHdoZW4gJ3NvbWV0aGluZycgaGFwcGVucyAod2hlbiBhIGJ1dHRvbiBpcyBjbGlja2VkIGZvciBleGFtcGxlKVxuICAgIGZ1bmN0aW9uIHNldEFjdGlvbkxpc3RlbmVyKGFjdGlvbilcbiAgICB7XG4gICAgICAgIC8vIHVzZXIgZmlsbHMgaW4gcmVnaXN0ZXIgZm9ybVxuICAgICAgICAvLyB1c2VyIHByZXNzZXMgJ3JlZ2lzdGVyJ1xuXG4gICAgICAgIC8vIGlmIHVzZXIgcHJlc3NlcyAncmVnaXN0ZXInLCBwZXJmb3JtIGFjdGlvblxuICAgICAgICAkKFwiI2NvbXBvbmVudFwiKS5vbihcInN1Ym1pdFwiLCBcIiNyZWdpc3RlcmZvcm1cIiwgYWN0aW9uKTtcbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gdGhlIG1ldGhvZHMgdGhhdCBjYW4gYmUgdXNlZCBieSBvdGhlciBwcm9ncmFtcyAodGhlIGNvbnRyb2xsZXIgaW4gdGhpcyBjYXNlKVxuICAgIHJldHVybiB7XG4gICAgICAgIHNldFZpZXc6IHNldFZpZXcsXG4gICAgICAgIHNldEFjdGlvbkxpc3RlbmVyOiBzZXRBY3Rpb25MaXN0ZW5lclxuICAgIH1cbn07IiwidmFyIFByb2R1Y3RWaWV3SGVscGVyID0gZnVuY3Rpb24oKVxue1xuICAgIC8vIENoYW5nZSB0aGUgdmlldyBvZiB0aGUgcGFnZVxuICAgIGZ1bmN0aW9uIHNldFZpZXcocHJvZHVjdClcbiAgICB7XG4gICAgICAgICAkKFwiI2NvbXBvbmVudFwiKS5sb2FkKCcvdmlld3Mvc2luZ2xlX3Byb2R1Y3Qvc2luZ2xlX3Byb2R1Y3QuaHRtbCcsIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgICQoXCIuc2luZ2xlcHJvZHVjdF9faW1hZ2UgaW1nXCIpLmF0dHIoXCJzcmNcIiwgcHJvZHVjdC5pbWFnZSk7XG4gICAgICAgICAgICAgICAgJChcIi5zaW5nbGVwcm9kdWN0X190aXRsZVwiKS5odG1sKHByb2R1Y3QudGl0bGUpO1xuICAgICAgICAgICAgICAgICQoXCIuc2luZ2xlcHJvZHVjdF9fcHJpY2VcIikuaHRtbChcIuKCrCBcIiArIHByb2R1Y3QucHJpY2UpO1xuXG4gICAgICAgICAgICAgICAgJChcIi5wcm9kdWN0X19lYW5cIikuYXBwZW5kKHByb2R1Y3QuZWFuX251bWJlcik7XG4gICAgICAgICAgICAgICAgJChcIi5wcm9kdWN0X19wbGF0Zm9ybVwiKS5hcHBlbmQocHJvZHVjdC5wbGF0Zm9ybSk7XG4gICAgICAgICAgICAgICAgJChcIi5wcm9kdWN0X19wdWJsaXNoZXJcIikuYXBwZW5kKHByb2R1Y3QucHVibGlzaGVyKTtcbiAgICAgICAgICAgICAgICAkKFwiLnByb2R1Y3RfX3BlZ2lcIikuYXBwZW5kKHByb2R1Y3QucGVnaV9hZ2UpO1xuICAgICAgICAgICAgICAgICQoXCIucHJvZHVjdF9fZ2VucmVcIikuYXBwZW5kKHByb2R1Y3QuZ2VucmUpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGQgPSBuZXcgRGF0ZShwcm9kdWN0LnJlbGVhc2VfZGF0ZSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgbW9udGhzID0gW1wiamFudWFyaVwiLCBcImZlYnJ1YXJpXCIsIFwibWFhcnRcIiwgXCJhcHJpbFwiLCBcIm1laVwiLCBcImp1bmlcIiwgXCJqdWxpXCIsIFwiYXVndXN0dXNcIiwgXCJzZXB0ZW1iZXJcIiwgXCJva3RvYmVyXCIsIFwibm92ZW1iZXJcIiwgXCJkZWNlbWJlclwiXTtcblxuICAgICAgICAgICAgICAgICQoXCIubGlwcm9kdWN0X19yZWxlYXNlZGF0ZVwiKS5hcHBlbmQoZC5nZXREYXkoKSArIFwiIFwiICsgbW9udGhzW2QuZ2V0TW9udGgoKV0gKyBcIiBcIiArIGQuZ2V0RnVsbFllYXIoKSk7XG5cbiAgICAgICAgICAgICAgICAkKFwiLnNpbmdsZXByb2R1Y3RfX2Rlc2NyXCIpLmh0bWwocHJvZHVjdC5kZXNjcmlwdGlvbik7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNldEFjdGlvbkxpc3RlbmVyKGFjdGlvbilcbiAgICB7XG4gICAgICAgIC8vIHVzZXIgZmlsbHMgaW4gcmVnaXN0ZXIgZm9ybVxuICAgICAgICAvLyB1c2VyIHByZXNzZXMgJ3JlZ2lzdGVyJ1xuXG4gICAgICAgIC8vIGlmIHVzZXIgcHJlc3NlcyAncmVnaXN0ZXInLCBwZXJmb3JtIGFjdGlvblxuICAgICAgICAkKGRvY3VtZW50KS5yZWFkeShhY3Rpb24pO1xuICAgIH1cblxuICAgIC8vIFJldHVybiB0aGUgbWV0aG9kcyB0aGF0IGNhbiBiZSB1c2VkIGJ5IG90aGVyIHByb2dyYW1zICh0aGUgY29udHJvbGxlciBpbiB0aGlzIGNhc2UpXG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2V0Vmlldzogc2V0VmlldyxcbiAgICAgICAgc2V0QWN0aW9uTGlzdGVuZXI6IHNldEFjdGlvbkxpc3RlbmVyXG4gICAgfVxufTsiXX0=
